<!DOCTYPE html>
<html>
<head>
    <title>Shelves - Tools a Cowboy Would Use</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#ffffff">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: "Times New Roman", Times, serif;
            background-color: #ffffff;
            color: #000000;
            line-height: 1.4;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Classic newspaper masthead */
        .masthead {
            border-top: 4px solid #000;
            border-bottom: 4px solid #000;
            padding: 15px 0;
            margin-bottom: 20px;
        }

        .masthead-title {
            font-family: "Times New Roman", Times, serif;
            font-size: 48px;
            font-weight: bold;
            text-align: center;
            letter-spacing: 2px;
            margin-bottom: 5px;
        }

        .masthead-subtitle {
            text-align: center;
            font-size: 14px;
            font-style: italic;
            color: #666;
        }

        /* Featured sections - newspaper layout */
        .featured-sections {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        .featured-main {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .featured-sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .featured-box {
            border: 2px solid #000;
            padding: 15px;
            background-color: #fff;
        }

        .featured-header {
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 2px solid #000;
            padding-bottom: 5px;
            margin-bottom: 12px;
        }

        .featured-hero {
            margin-bottom: 15px;
        }

        .featured-hero img {
            width: 100%;
            height: auto;
            display: block;
            border: 1px solid #000;
            max-height: 400px;
            object-fit: cover;
            background-color: #f5f5f5;
        }

        .featured-small-image {
            width: 100%;
            height: auto;
            display: block;
            border: 1px solid #000;
            max-height: 200px;
            object-fit: cover;
            margin-bottom: 10px;
            background-color: #f5f5f5;
        }

        .featured-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 8px;
            line-height: 1.2;
        }

        .featured-title a {
            color: #000;
            text-decoration: none;
        }

        .featured-title a:hover {
            text-decoration: underline;
        }

        .featured-byline {
            font-size: 13px;
            color: #666;
            margin-bottom: 10px;
            font-style: italic;
        }

        .featured-excerpt {
            font-size: 15px;
            line-height: 1.6;
            color: #333;
        }

        .featured-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .featured-list-item {
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .featured-list-item:last-child {
            border-bottom: none;
        }

        .featured-list-item a {
            color: #00008b;
            text-decoration: underline;
            font-size: 14px;
            font-weight: bold;
        }

        .featured-list-item a:visited {
            color: #551a8b;
        }

        .featured-list-item a:hover {
            text-decoration: none;
        }

        .featured-list-meta {
            font-size: 12px;
            color: #666;
            margin-top: 3px;
        }

        /* Craigslist-style navigation */
        .navigation {
            background-color: #f8f8f8;
            border: 1px solid #ccc;
            padding: 15px;
            margin-bottom: 20px;
        }

        .nav-header {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #000;
        }

        .nav-links {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 8px 20px;
        }

        .nav-link {
            color: #00008b;
            text-decoration: underline;
            font-size: 14px;
            cursor: pointer;
            display: inline-block;
        }

        .nav-link:hover {
            color: #551a8b;
        }

        .nav-link.active {
            font-weight: bold;
            color: #000;
            text-decoration: none;
        }

        /* Main content area */
        .content-wrapper {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
        }

        .category-header {
            border-bottom: 2px solid #000;
            padding-bottom: 8px;
            margin-bottom: 15px;
        }

        .category-title {
            font-size: 28px;
            font-weight: bold;
            font-family: "Times New Roman", Times, serif;
        }

        .category-count {
            font-size: 14px;
            color: #666;
            font-style: italic;
            margin-left: 10px;
        }

        /* Multi-column layout for desktop */
        .items-grid {
            column-count: 3;
            column-gap: 30px;
        }

        .item {
            break-inside: avoid;
            page-break-inside: avoid;
            margin-bottom: 18px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .item-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 3px;
        }

        .item-title a {
            color: #00008b;
            text-decoration: underline;
        }

        .item-title a:visited {
            color: #551a8b;
        }

        .item-title a:hover {
            text-decoration: none;
        }

        .item-meta {
            font-size: 13px;
            color: #666;
            margin-bottom: 5px;
        }

        .item-description {
            font-size: 14px;
            color: #333;
            line-height: 1.5;
        }

        /* Loading state */
        .loading {
            text-align: center;
            font-size: 16px;
            padding: 40px;
            color: #666;
        }

        .no-content {
            text-align: center;
            font-size: 16px;
            padding: 40px;
            color: #666;
            font-style: italic;
        }

        /* Footer */
        .footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid #000;
            text-align: center;
            font-size: 12px;
            color: #666;
        }

        .footer a {
            color: #00008b;
            text-decoration: underline;
        }

        /* Tablet styles */
        @media (max-width: 1024px) {
            body {
                padding: 15px;
            }

            .masthead-title {
                font-size: 36px;
            }

            .featured-sections {
                grid-template-columns: 1fr;
            }

            .featured-sidebar {
                grid-template-columns: 1fr 1fr;
                grid-template-rows: auto;
            }

            .items-grid {
                column-count: 2;
                column-gap: 20px;
            }

            .nav-links {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* Mobile styles */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .masthead-title {
                font-size: 28px;
                letter-spacing: 1px;
            }

            .masthead-subtitle {
                font-size: 12px;
            }

            .featured-sections {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .featured-sidebar {
                grid-template-columns: 1fr;
            }

            .featured-title {
                font-size: 20px;
            }

            .featured-hero img {
                max-height: 250px;
            }

            .navigation {
                padding: 10px;
            }

            .nav-links {
                grid-template-columns: repeat(2, 1fr);
                gap: 6px 10px;
            }

            .nav-link {
                font-size: 13px;
            }

            .items-grid {
                column-count: 1;
            }

            .category-title {
                font-size: 22px;
            }

            .item {
                margin-bottom: 15px;
                padding-bottom: 12px;
            }

            .item-title {
                font-size: 15px;
            }

            .item-meta {
                font-size: 12px;
            }

            .item-description {
                font-size: 13px;
            }
        }

        /* Very small mobile */
        @media (max-width: 480px) {
            .masthead-title {
                font-size: 24px;
            }

            .nav-links {
                grid-template-columns: 1fr;
            }
        }

        /* Print styles */
        @media print {
            body {
                max-width: 100%;
            }

            .navigation {
                display: none;
            }

            .items-grid {
                column-count: 3;
            }
        }
    </style>
</head>
<body>
    <!-- Classic newspaper masthead -->
    <header class="masthead">
        <h1 class="masthead-title">SHELVES</h1>
        <p class="masthead-subtitle">A Curated Collection from Tools a Cowboy Would Use</p>
    </header>

    <!-- Featured sections - newspaper front page style -->
    <section class="featured-sections" id="featured-sections" style="display: none;">
        <div class="featured-main">
            <!-- Featured Writing with hero image -->
            <div class="featured-box" id="featured-writing-box" style="display: none;">
                <div class="featured-header">Featured Reading</div>
                <div id="featured-writing-content"></div>
            </div>

            <!-- Featured Video -->
            <div class="featured-box" id="featured-video-box" style="display: none;">
                <div class="featured-header">Watch This</div>
                <div id="featured-video-content"></div>
            </div>

            <!-- Featured Song -->
            <div class="featured-box" id="featured-song-box" style="display: none;">
                <div class="featured-header">On Repeat</div>
                <div id="featured-song-content"></div>
            </div>
        </div>

        <div class="featured-sidebar">
            <!-- Recently Added Apps -->
            <div class="featured-box" id="featured-apps-box" style="display: none;">
                <div class="featured-header">New Apps</div>
                <ul class="featured-list" id="featured-apps-list"></ul>
            </div>

            <!-- Featured Book -->
            <div class="featured-box" id="featured-book-box" style="display: none;">
                <div class="featured-header">Worth Reading</div>
                <div id="featured-book-content"></div>
            </div>

            <!-- Featured Website -->
            <div class="featured-box" id="featured-website-box" style="display: none;">
                <div class="featured-header">Link of Note</div>
                <div id="featured-website-content"></div>
            </div>

            <!-- More Writing -->
            <div class="featured-box" id="featured-writing2-box" style="display: none;">
                <div class="featured-header">Also Read</div>
                <ul class="featured-list" id="featured-writing2-list"></ul>
            </div>
        </div>
    </section>

    <!-- Craigslist-style navigation -->
    <nav class="navigation">
        <div class="nav-header">Categories:</div>
        <div class="nav-links">
            <a class="nav-link" onclick="switchCategory('Apps')">apps</a>
            <a class="nav-link" onclick="switchCategory('Books')">books</a>
            <a class="nav-link" onclick="switchCategory('Songs')">songs</a>
            <a class="nav-link" onclick="switchCategory('Videos')">videos</a>
            <a class="nav-link" onclick="switchCategory('Writing')">writing</a>
            <a class="nav-link" onclick="switchCategory('Websites')">websites</a>
        </div>
    </nav>

    <!-- Main content -->
    <main class="content-wrapper">
        <div id="loading" class="loading" style="display: none;">Loading...</div>
        <div id="no-content" class="no-content" style="display: block;">Select a category above to browse.</div>
        <div id="content-area" style="display: none;">
            <div class="category-header">
                <h2 class="category-title">
                    <span id="category-name"></span>
                    <span class="category-count" id="item-count"></span>
                </h2>
            </div>
            <div class="items-grid" id="items-grid"></div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <p>&copy; 2025 Tools a Cowboy Would Use | <a href="/">Home</a> | <a href="https://blog.toolsacowboywoulduse.com" target="_blank">Subscribe for Updates</a></p>
    </footer>

    <script>
        // Google Sheets configuration
        const SHEET_ID = '1EXPDGRvyutq8WpptlhrdlEH3ftJzw9bjk6kQtNBcQh4';
        const SHEET_NAMES = {
            'Apps': 'Apps',
            'Books': 'Books',
            'Songs': 'Songs',
            'Videos': 'Videos',
            'Writing': 'Writing',
            'Websites': 'Websites'
        };

        let currentCategory = null;
        let allData = {};

        // Utility functions
        function getAppStoreId(url) {
            const match = url.match(/id(\d+)/);
            return match ? match[1] : null;
        }

        function getAppleMusicId(url) {
            const match = url.match(/[?&]i=(\d+)/);
            return match ? match[1] : null;
        }

        function getAppleBooksId(url) {
            const match = url.match(/id(\d+)/);
            return match ? match[1] : null;
        }

        function getYouTubeVideoId(url) {
            const patterns = [
                /(?:youtube\.com\/watch\?v=)([^&\n?#]+)/,
                /(?:youtu\.be\/)([^&\n?#]+)/,
                /(?:youtube\.com\/embed\/)([^&\n?#]+)/
            ];

            for (const pattern of patterns) {
                const match = url.match(pattern);
                if (match) return match[1];
            }
            return null;
        }

        // Metadata fetching functions
        async function getAppMetadata(appStoreUrl) {
            try {
                const appId = getAppStoreId(appStoreUrl);
                if (!appId) return null;

                const response = await fetch(`https://itunes.apple.com/lookup?id=${appId}`);
                const data = await response.json();

                if (data.results && data.results.length > 0) {
                    const app = data.results[0];
                    return {
                        name: app.trackName,
                        subtitle: app.sellerName || app.artistName,
                        description: app.description
                    };
                }
            } catch (error) {
                console.error('Error fetching app metadata:', error);
            }
            return null;
        }

        async function getSongMetadata(appleMusicUrl) {
            try {
                const songId = getAppleMusicId(appleMusicUrl);
                if (!songId) return null;

                const response = await fetch(`https://itunes.apple.com/lookup?id=${songId}`);
                const data = await response.json();

                if (data.results && data.results.length > 0) {
                    const song = data.results[0];
                    return {
                        trackName: song.trackName,
                        artistName: song.artistName,
                        albumName: song.collectionName
                    };
                }
            } catch (error) {
                console.error('Error fetching song metadata:', error);
            }
            return null;
        }

        async function getBookMetadata(appleBooksUrl) {
            try {
                const bookId = getAppleBooksId(appleBooksUrl);
                if (!bookId) return null;

                const response = await fetch(`https://itunes.apple.com/lookup?id=${bookId}`);
                const data = await response.json();

                if (data.results && data.results.length > 0) {
                    const book = data.results[0];
                    return {
                        trackName: book.trackName,
                        artistName: book.artistName,
                        description: book.description
                    };
                }
            } catch (error) {
                console.error('Error fetching book metadata:', error);
            }
            return null;
        }

        async function getVideoMetadata(youtubeUrl, fallbackTitle) {
            try {
                const videoId = getYouTubeVideoId(youtubeUrl);
                if (!videoId) return { title: fallbackTitle };

                const oembedResponse = await fetch(`https://www.youtube.com/oembed?url=${encodeURIComponent(youtubeUrl)}&format=json`);
                if (oembedResponse.ok) {
                    const oembedData = await oembedResponse.json();
                    return {
                        title: oembedData.title || fallbackTitle,
                        author: oembedData.author_name
                    };
                }
            } catch (error) {
                console.error('Error fetching video metadata:', error);
            }
            return { title: fallbackTitle };
        }

        // Fetch data from Google Sheets
        async function fetchSheetData(sheetName) {
            try {
                const response = await fetch(
                    `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${sheetName}`
                );

                if (!response.ok) {
                    throw new Error(`Failed to fetch ${sheetName} data`);
                }

                const text = await response.text();
                const json = JSON.parse(text.substr(47).slice(0, -2));
                const rows = json.table.rows.map(row =>
                    row.c.map(cell => cell ? cell.v : '')
                );

                return rows;
            } catch (error) {
                console.error(`Error loading ${sheetName}:`, error);
                return [];
            }
        }

        // Load all data
        async function loadAllData() {
            const loading = document.getElementById('loading');
            loading.style.display = 'block';
            document.getElementById('no-content').style.display = 'none';

            for (const [category, sheetName] of Object.entries(SHEET_NAMES)) {
                allData[category] = await fetchSheetData(sheetName);
            }

            loading.style.display = 'none';
        }

        // Switch category
        function switchCategory(category) {
            currentCategory = category;

            // Update nav active state
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            event.target.classList.add('active');

            // Update content
            displayCategory();
        }

        // Display category content
        async function displayCategory() {
            if (!currentCategory) {
                document.getElementById('content-area').style.display = 'none';
                document.getElementById('no-content').style.display = 'block';
                return;
            }

            const data = allData[currentCategory] || [];

            if (data.length <= 1) {
                document.getElementById('content-area').style.display = 'none';
                document.getElementById('no-content').textContent = `No ${currentCategory.toLowerCase()} available yet.`;
                document.getElementById('no-content').style.display = 'block';
                return;
            }

            document.getElementById('no-content').style.display = 'none';
            document.getElementById('content-area').style.display = 'block';
            document.getElementById('category-name').textContent = currentCategory;

            const items = data.slice(1); // Skip header row
            const itemsHtml = await generateItemsHtml(items);

            document.getElementById('items-grid').innerHTML = itemsHtml.join('');
            document.getElementById('item-count').textContent = `(${items.length} items)`;
        }

        // Generate HTML for items based on category
        async function generateItemsHtml(items) {
            const htmlPromises = items.map(async (item) => {
                if (currentCategory === 'Apps') {
                    return await generateAppHtml(item);
                } else if (currentCategory === 'Songs') {
                    return await generateSongHtml(item);
                } else if (currentCategory === 'Books') {
                    return await generateBookHtml(item);
                } else if (currentCategory === 'Videos') {
                    return await generateVideoHtml(item);
                } else if (currentCategory === 'Writing') {
                    return await generateWritingHtml(item);
                } else if (currentCategory === 'Websites') {
                    return await generateWebsiteHtml(item);
                }
            });

            const htmlArray = await Promise.all(htmlPromises);
            return htmlArray.filter(html => html !== null);
        }

        async function generateAppHtml([appStoreUrl, manualName, category, ourDescription]) {
            if (!appStoreUrl) return null;

            const appMeta = await getAppMetadata(appStoreUrl);
            const title = appMeta?.name || manualName || 'Unknown App';
            const subtitle = appMeta?.subtitle || '';
            const description = ourDescription || appMeta?.description || '';

            return `
                <div class="item">
                    <div class="item-title"><a href="${appStoreUrl}" target="_blank">${title}</a></div>
                    ${subtitle ? `<div class="item-meta">${subtitle}</div>` : ''}
                    ${description ? `<div class="item-description">${description.substring(0, 200)}${description.length > 200 ? '...' : ''}</div>` : ''}
                </div>
            `;
        }

        async function generateSongHtml([title, appleMusicUrl, artist]) {
            if (!appleMusicUrl || !title) return null;

            const songMeta = await getSongMetadata(appleMusicUrl);
            const trackName = songMeta?.trackName || title;
            const artistName = songMeta?.artistName || artist;
            const albumName = songMeta?.albumName || '';

            return `
                <div class="item">
                    <div class="item-title"><a href="${appleMusicUrl}" target="_blank">${trackName}</a></div>
                    <div class="item-meta">${artistName}${albumName ? ` - ${albumName}` : ''}</div>
                </div>
            `;
        }

        async function generateBookHtml([title, appleBooksUrl, ourDescription]) {
            if (!appleBooksUrl || !title) return null;

            const bookMeta = await getBookMetadata(appleBooksUrl);
            const bookTitle = bookMeta?.trackName || title;
            const authorName = bookMeta?.artistName || '';
            const description = ourDescription || bookMeta?.description || '';

            return `
                <div class="item">
                    <div class="item-title"><a href="${appleBooksUrl}" target="_blank">${bookTitle}</a></div>
                    ${authorName ? `<div class="item-meta">by ${authorName}</div>` : ''}
                    ${description ? `<div class="item-description">${description.substring(0, 200)}${description.length > 200 ? '...' : ''}</div>` : ''}
                </div>
            `;
        }

        async function generateVideoHtml([title, youtubeUrl]) {
            if (!youtubeUrl || !title) return null;

            const videoMeta = await getVideoMetadata(youtubeUrl, title);
            const videoTitle = videoMeta?.title || title;
            const author = videoMeta?.author || '';

            return `
                <div class="item">
                    <div class="item-title"><a href="${youtubeUrl}" target="_blank">${title}</a></div>
                    ${videoTitle !== title ? `<div class="item-meta">${videoTitle}</div>` : ''}
                    ${author ? `<div class="item-meta">${author}</div>` : ''}
                </div>
            `;
        }

        async function generateWritingHtml([title, url, author, description]) {
            if (!url || !title) return null;

            const domain = new URL(url).hostname;

            return `
                <div class="item">
                    <div class="item-title"><a href="${url}" target="_blank">${title}</a></div>
                    ${author ? `<div class="item-meta">by ${author} - ${domain}</div>` : `<div class="item-meta">${domain}</div>`}
                    ${description ? `<div class="item-description">${description}</div>` : ''}
                </div>
            `;
        }

        async function generateWebsiteHtml([title, url, description]) {
            if (!url || !title) return null;

            const domain = new URL(url).hostname;

            return `
                <div class="item">
                    <div class="item-title"><a href="${url}" target="_blank">${title}</a></div>
                    <div class="item-meta">${domain}</div>
                    ${description ? `<div class="item-description">${description}</div>` : ''}
                </div>
            `;
        }

        // Fetch Open Graph image from URL using Microlink API
        async function getOpenGraphImage(url) {
            try {
                // Use Microlink API to get Open Graph image
                // Free tier: 50 requests/day, 1 req/sec
                const microlinkUrl = `https://api.microlink.io/?url=${encodeURIComponent(url)}&screenshot=true&meta=false&embed=screenshot.url`;

                const response = await fetch(microlinkUrl);
                const data = await response.json();

                if (data.status === 'success' && data.data && data.data.screenshot) {
                    return data.data.screenshot.url;
                }

                // Fallback to trying to get OG image
                if (data.status === 'success' && data.data && data.data.image) {
                    return data.data.image.url;
                }

                return null;
            } catch (error) {
                console.error('Error fetching OG image:', error);
                return null;
            }
        }

        // Try to extract image from YouTube URL with fallbacks
        function getYouTubeThumbnail(videoId) {
            if (!videoId) return null;
            // Return hqdefault which is always available (480x360)
            // We'll use this as it's reliable and good quality
            return `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`;
        }

        // Get best available YouTube thumbnail
        async function getBestYouTubeThumbnail(url) {
            const videoId = getYouTubeVideoId(url);
            if (!videoId) return null;

            // Try different qualities in order of preference
            const thumbnails = [
                `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`,
                `https://img.youtube.com/vi/${videoId}/sddefault.jpg`,
                `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`
            ];

            // Try to load the highest quality available
            for (const thumb of thumbnails) {
                try {
                    const response = await fetch(thumb, { method: 'HEAD' });
                    if (response.ok) {
                        return thumb;
                    }
                } catch {
                    continue;
                }
            }

            // Fallback to hqdefault which always exists
            return thumbnails[2];
        }

        // Generate featured content
        async function generateFeaturedContent() {
            const featuredSections = document.getElementById('featured-sections');
            let hasContent = false;

            // Featured Writing (first item) with hero image
            if (allData['Writing'] && allData['Writing'].length > 1) {
                const [title, url, author, description] = allData['Writing'][1];
                if (title && url) {
                    const domain = new URL(url).hostname;
                    const ogImage = await getOpenGraphImage(url);

                    let imageHtml = '';
                    if (ogImage) {
                        imageHtml = `<div class="featured-hero"><img src="${ogImage}" alt="${title}" onerror="this.parentElement.style.display='none'"></div>`;
                    }

                    document.getElementById('featured-writing-content').innerHTML = `
                        ${imageHtml}
                        <div class="featured-title"><a href="${url}" target="_blank">${title}</a></div>
                        ${author ? `<div class="featured-byline">by ${author}</div>` : ''}
                        ${description ? `<div class="featured-excerpt">${description}</div>` : ''}
                    `;
                    document.getElementById('featured-writing-box').style.display = 'block';
                    hasContent = true;
                }
            }

            // More Writing items (2-4)
            if (allData['Writing'] && allData['Writing'].length > 2) {
                const writings = allData['Writing'].slice(2, 5); // Get items 2-4
                const writingItems = writings.map(([title, url, author]) => {
                    if (!title || !url) return null;
                    return `
                        <li class="featured-list-item">
                            <a href="${url}" target="_blank">${title}</a>
                            ${author ? `<div class="featured-list-meta">by ${author}</div>` : ''}
                        </li>
                    `;
                });
                const filteredItems = writingItems.filter(item => item !== null);
                if (filteredItems.length > 0) {
                    document.getElementById('featured-writing2-list').innerHTML = filteredItems.join('');
                    document.getElementById('featured-writing2-box').style.display = 'block';
                    hasContent = true;
                }
            }

            // Featured Video with thumbnail
            if (allData['Videos'] && allData['Videos'].length > 1) {
                const [title, youtubeUrl] = allData['Videos'][1];
                if (title && youtubeUrl) {
                    const videoMeta = await getVideoMetadata(youtubeUrl, title);
                    const thumbnail = await getBestYouTubeThumbnail(youtubeUrl);

                    console.log('YouTube URL:', youtubeUrl);
                    console.log('Video ID:', getYouTubeVideoId(youtubeUrl));
                    console.log('Thumbnail URL:', thumbnail);

                    let imageHtml = '';
                    if (thumbnail) {
                        imageHtml = `<div class="featured-hero"><img src="${thumbnail}" alt="${title}" onerror="console.error('Image failed to load:', this.src); this.parentElement.style.display='none';"></div>`;
                    }

                    document.getElementById('featured-video-content').innerHTML = `
                        ${imageHtml}
                        <div class="featured-title"><a href="${youtubeUrl}" target="_blank">${title}</a></div>
                        ${videoMeta?.author ? `<div class="featured-byline">${videoMeta.author}</div>` : ''}
                    `;
                    document.getElementById('featured-video-box').style.display = 'block';
                    hasContent = true;
                }
            }

            // Recent Apps (first 5 items)
            if (allData['Apps'] && allData['Apps'].length > 1) {
                const apps = allData['Apps'].slice(1, 6); // Get first 5
                const appItems = await Promise.all(apps.map(async ([appStoreUrl, manualName]) => {
                    if (!appStoreUrl) return null;
                    const appMeta = await getAppMetadata(appStoreUrl);
                    const title = appMeta?.name || manualName || 'Unknown App';
                    return `
                        <li class="featured-list-item">
                            <a href="${appStoreUrl}" target="_blank">${title}</a>
                        </li>
                    `;
                }));
                const filteredItems = appItems.filter(item => item !== null);
                if (filteredItems.length > 0) {
                    document.getElementById('featured-apps-list').innerHTML = filteredItems.join('');
                    document.getElementById('featured-apps-box').style.display = 'block';
                    hasContent = true;
                }
            }

            // Featured Song (first item)
            if (allData['Songs'] && allData['Songs'].length > 1) {
                const [title, appleMusicUrl, artist] = allData['Songs'][1];
                if (title && appleMusicUrl) {
                    const songMeta = await getSongMetadata(appleMusicUrl);
                    const trackName = songMeta?.trackName || title;
                    const artistName = songMeta?.artistName || artist;
                    const albumName = songMeta?.albumName || '';
                    document.getElementById('featured-song-content').innerHTML = `
                        <div class="featured-title"><a href="${appleMusicUrl}" target="_blank">${trackName}</a></div>
                        <div class="featured-byline">${artistName}${albumName ? ` - ${albumName}` : ''}</div>
                    `;
                    document.getElementById('featured-song-box').style.display = 'block';
                    hasContent = true;
                }
            }

            // Featured Book (first item)
            if (allData['Books'] && allData['Books'].length > 1) {
                const [title, appleBooksUrl, ourDescription] = allData['Books'][1];
                if (title && appleBooksUrl) {
                    const bookMeta = await getBookMetadata(appleBooksUrl);
                    const bookTitle = bookMeta?.trackName || title;
                    const authorName = bookMeta?.artistName || '';
                    const description = ourDescription || bookMeta?.description || '';
                    document.getElementById('featured-book-content').innerHTML = `
                        <div class="featured-title"><a href="${appleBooksUrl}" target="_blank">${bookTitle}</a></div>
                        ${authorName ? `<div class="featured-byline">by ${authorName}</div>` : ''}
                        ${description ? `<div class="featured-excerpt">${description.substring(0, 150)}${description.length > 150 ? '...' : ''}</div>` : ''}
                    `;
                    document.getElementById('featured-book-box').style.display = 'block';
                    hasContent = true;
                }
            }

            // Featured Website (first item) with small image
            if (allData['Websites'] && allData['Websites'].length > 1) {
                const [title, url, description] = allData['Websites'][1];
                if (title && url) {
                    const domain = new URL(url).hostname;
                    const ogImage = await getOpenGraphImage(url);

                    let imageHtml = '';
                    if (ogImage) {
                        imageHtml = `<img src="${ogImage}" alt="${title}" class="featured-small-image" onerror="this.style.display='none'">`;
                    }

                    document.getElementById('featured-website-content').innerHTML = `
                        ${imageHtml}
                        <div class="featured-title"><a href="${url}" target="_blank">${title}</a></div>
                        <div class="featured-byline">${domain}</div>
                        ${description ? `<div class="featured-excerpt">${description.substring(0, 120)}${description.length > 120 ? '...' : ''}</div>` : ''}
                    `;
                    document.getElementById('featured-website-box').style.display = 'block';
                    hasContent = true;
                }
            }

            if (hasContent) {
                featuredSections.style.display = 'grid';
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', async function() {
            await loadAllData();
            await generateFeaturedContent();
        });
    </script>
</body>
</html>
