<!DOCTYPE html>
<html>
<head>
    <title>Shelves - Tools a Cowboy Would Use</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#ffffff">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: "Times New Roman", Times, serif;
            background-color: #ffffff;
            color: #000000;
            line-height: 1.4;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Classic newspaper masthead */
        .masthead {
            border-top: 4px solid #000;
            border-bottom: 4px solid #000;
            padding: 15px 0;
            margin-bottom: 20px;
        }

        .masthead-title {
            font-family: "Times New Roman", Times, serif;
            font-size: 48px;
            font-weight: bold;
            text-align: center;
            letter-spacing: 2px;
            margin-bottom: 5px;
        }

        .masthead-subtitle {
            text-align: center;
            font-size: 14px;
            font-style: italic;
            color: #666;
        }

        /* Craigslist-style navigation */
        .navigation {
            background-color: #f8f8f8;
            border: 1px solid #ccc;
            padding: 15px;
            margin-bottom: 20px;
        }

        .nav-header {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #000;
        }

        .nav-links {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 8px 20px;
        }

        .nav-link {
            color: #00008b;
            text-decoration: underline;
            font-size: 14px;
            cursor: pointer;
            display: inline-block;
        }

        .nav-link:hover {
            color: #551a8b;
        }

        .nav-link.active {
            font-weight: bold;
            color: #000;
            text-decoration: none;
        }

        /* Main content area */
        .content-wrapper {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
        }

        .category-header {
            border-bottom: 2px solid #000;
            padding-bottom: 8px;
            margin-bottom: 15px;
        }

        .category-title {
            font-size: 28px;
            font-weight: bold;
            font-family: "Times New Roman", Times, serif;
        }

        .category-count {
            font-size: 14px;
            color: #666;
            font-style: italic;
            margin-left: 10px;
        }

        /* Multi-column layout for desktop */
        .items-grid {
            column-count: 3;
            column-gap: 30px;
        }

        .item {
            break-inside: avoid;
            page-break-inside: avoid;
            margin-bottom: 18px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .item-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 3px;
        }

        .item-title a {
            color: #00008b;
            text-decoration: underline;
        }

        .item-title a:visited {
            color: #551a8b;
        }

        .item-title a:hover {
            text-decoration: none;
        }

        .item-meta {
            font-size: 13px;
            color: #666;
            margin-bottom: 5px;
        }

        .item-description {
            font-size: 14px;
            color: #333;
            line-height: 1.5;
        }

        /* Loading state */
        .loading {
            text-align: center;
            font-size: 16px;
            padding: 40px;
            color: #666;
        }

        .no-content {
            text-align: center;
            font-size: 16px;
            padding: 40px;
            color: #666;
            font-style: italic;
        }

        /* Footer */
        .footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid #000;
            text-align: center;
            font-size: 12px;
            color: #666;
        }

        .footer a {
            color: #00008b;
            text-decoration: underline;
        }

        /* Tablet styles */
        @media (max-width: 1024px) {
            body {
                padding: 15px;
            }

            .masthead-title {
                font-size: 36px;
            }

            .items-grid {
                column-count: 2;
                column-gap: 20px;
            }

            .nav-links {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* Mobile styles */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .masthead-title {
                font-size: 28px;
                letter-spacing: 1px;
            }

            .masthead-subtitle {
                font-size: 12px;
            }

            .navigation {
                padding: 10px;
            }

            .nav-links {
                grid-template-columns: repeat(2, 1fr);
                gap: 6px 10px;
            }

            .nav-link {
                font-size: 13px;
            }

            .items-grid {
                column-count: 1;
            }

            .category-title {
                font-size: 22px;
            }

            .item {
                margin-bottom: 15px;
                padding-bottom: 12px;
            }

            .item-title {
                font-size: 15px;
            }

            .item-meta {
                font-size: 12px;
            }

            .item-description {
                font-size: 13px;
            }
        }

        /* Very small mobile */
        @media (max-width: 480px) {
            .masthead-title {
                font-size: 24px;
            }

            .nav-links {
                grid-template-columns: 1fr;
            }
        }

        /* Print styles */
        @media print {
            body {
                max-width: 100%;
            }

            .navigation {
                display: none;
            }

            .items-grid {
                column-count: 3;
            }
        }
    </style>
</head>
<body>
    <!-- Classic newspaper masthead -->
    <header class="masthead">
        <h1 class="masthead-title">SHELVES</h1>
        <p class="masthead-subtitle">A Curated Collection from Tools a Cowboy Would Use</p>
    </header>

    <!-- Craigslist-style navigation -->
    <nav class="navigation">
        <div class="nav-header">Categories:</div>
        <div class="nav-links">
            <a class="nav-link" onclick="switchCategory('Apps')">apps</a>
            <a class="nav-link" onclick="switchCategory('Books')">books</a>
            <a class="nav-link" onclick="switchCategory('Songs')">songs</a>
            <a class="nav-link" onclick="switchCategory('Videos')">videos</a>
            <a class="nav-link" onclick="switchCategory('Writing')">writing</a>
            <a class="nav-link" onclick="switchCategory('Websites')">websites</a>
        </div>
    </nav>

    <!-- Main content -->
    <main class="content-wrapper">
        <div id="loading" class="loading" style="display: none;">Loading...</div>
        <div id="no-content" class="no-content" style="display: block;">Select a category above to browse.</div>
        <div id="content-area" style="display: none;">
            <div class="category-header">
                <h2 class="category-title">
                    <span id="category-name"></span>
                    <span class="category-count" id="item-count"></span>
                </h2>
            </div>
            <div class="items-grid" id="items-grid"></div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <p>&copy; 2025 Tools a Cowboy Would Use | <a href="/">Home</a> | <a href="https://blog.toolsacowboywoulduse.com" target="_blank">Subscribe for Updates</a></p>
    </footer>

    <script>
        // Google Sheets configuration
        const SHEET_ID = '1EXPDGRvyutq8WpptlhrdlEH3ftJzw9bjk6kQtNBcQh4';
        const SHEET_NAMES = {
            'Apps': 'Apps',
            'Books': 'Books',
            'Songs': 'Songs',
            'Videos': 'Videos',
            'Writing': 'Writing',
            'Websites': 'Websites'
        };

        let currentCategory = null;
        let allData = {};

        // Utility functions
        function getAppStoreId(url) {
            const match = url.match(/id(\d+)/);
            return match ? match[1] : null;
        }

        function getAppleMusicId(url) {
            const match = url.match(/[?&]i=(\d+)/);
            return match ? match[1] : null;
        }

        function getAppleBooksId(url) {
            const match = url.match(/id(\d+)/);
            return match ? match[1] : null;
        }

        function getYouTubeVideoId(url) {
            const patterns = [
                /(?:youtube\.com\/watch\?v=)([^&\n?#]+)/,
                /(?:youtu\.be\/)([^&\n?#]+)/,
                /(?:youtube\.com\/embed\/)([^&\n?#]+)/
            ];

            for (const pattern of patterns) {
                const match = url.match(pattern);
                if (match) return match[1];
            }
            return null;
        }

        // Metadata fetching functions
        async function getAppMetadata(appStoreUrl) {
            try {
                const appId = getAppStoreId(appStoreUrl);
                if (!appId) return null;

                const response = await fetch(`https://itunes.apple.com/lookup?id=${appId}`);
                const data = await response.json();

                if (data.results && data.results.length > 0) {
                    const app = data.results[0];
                    return {
                        name: app.trackName,
                        subtitle: app.sellerName || app.artistName,
                        description: app.description
                    };
                }
            } catch (error) {
                console.error('Error fetching app metadata:', error);
            }
            return null;
        }

        async function getSongMetadata(appleMusicUrl) {
            try {
                const songId = getAppleMusicId(appleMusicUrl);
                if (!songId) return null;

                const response = await fetch(`https://itunes.apple.com/lookup?id=${songId}`);
                const data = await response.json();

                if (data.results && data.results.length > 0) {
                    const song = data.results[0];
                    return {
                        trackName: song.trackName,
                        artistName: song.artistName,
                        albumName: song.collectionName
                    };
                }
            } catch (error) {
                console.error('Error fetching song metadata:', error);
            }
            return null;
        }

        async function getBookMetadata(appleBooksUrl) {
            try {
                const bookId = getAppleBooksId(appleBooksUrl);
                if (!bookId) return null;

                const response = await fetch(`https://itunes.apple.com/lookup?id=${bookId}`);
                const data = await response.json();

                if (data.results && data.results.length > 0) {
                    const book = data.results[0];
                    return {
                        trackName: book.trackName,
                        artistName: book.artistName,
                        description: book.description
                    };
                }
            } catch (error) {
                console.error('Error fetching book metadata:', error);
            }
            return null;
        }

        async function getVideoMetadata(youtubeUrl, fallbackTitle) {
            try {
                const videoId = getYouTubeVideoId(youtubeUrl);
                if (!videoId) return { title: fallbackTitle };

                const oembedResponse = await fetch(`https://www.youtube.com/oembed?url=${encodeURIComponent(youtubeUrl)}&format=json`);
                if (oembedResponse.ok) {
                    const oembedData = await oembedResponse.json();
                    return {
                        title: oembedData.title || fallbackTitle,
                        author: oembedData.author_name
                    };
                }
            } catch (error) {
                console.error('Error fetching video metadata:', error);
            }
            return { title: fallbackTitle };
        }

        // Fetch data from Google Sheets
        async function fetchSheetData(sheetName) {
            try {
                const response = await fetch(
                    `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${sheetName}`
                );

                if (!response.ok) {
                    throw new Error(`Failed to fetch ${sheetName} data`);
                }

                const text = await response.text();
                const json = JSON.parse(text.substr(47).slice(0, -2));
                const rows = json.table.rows.map(row =>
                    row.c.map(cell => cell ? cell.v : '')
                );

                return rows;
            } catch (error) {
                console.error(`Error loading ${sheetName}:`, error);
                return [];
            }
        }

        // Load all data
        async function loadAllData() {
            const loading = document.getElementById('loading');
            loading.style.display = 'block';
            document.getElementById('no-content').style.display = 'none';

            for (const [category, sheetName] of Object.entries(SHEET_NAMES)) {
                allData[category] = await fetchSheetData(sheetName);
            }

            loading.style.display = 'none';
        }

        // Switch category
        function switchCategory(category) {
            currentCategory = category;

            // Update nav active state
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            event.target.classList.add('active');

            // Update content
            displayCategory();
        }

        // Display category content
        async function displayCategory() {
            if (!currentCategory) {
                document.getElementById('content-area').style.display = 'none';
                document.getElementById('no-content').style.display = 'block';
                return;
            }

            const data = allData[currentCategory] || [];

            if (data.length <= 1) {
                document.getElementById('content-area').style.display = 'none';
                document.getElementById('no-content').textContent = `No ${currentCategory.toLowerCase()} available yet.`;
                document.getElementById('no-content').style.display = 'block';
                return;
            }

            document.getElementById('no-content').style.display = 'none';
            document.getElementById('content-area').style.display = 'block';
            document.getElementById('category-name').textContent = currentCategory;

            const items = data.slice(1); // Skip header row
            const itemsHtml = await generateItemsHtml(items);

            document.getElementById('items-grid').innerHTML = itemsHtml.join('');
            document.getElementById('item-count').textContent = `(${items.length} items)`;
        }

        // Generate HTML for items based on category
        async function generateItemsHtml(items) {
            const htmlPromises = items.map(async (item) => {
                if (currentCategory === 'Apps') {
                    return await generateAppHtml(item);
                } else if (currentCategory === 'Songs') {
                    return await generateSongHtml(item);
                } else if (currentCategory === 'Books') {
                    return await generateBookHtml(item);
                } else if (currentCategory === 'Videos') {
                    return await generateVideoHtml(item);
                } else if (currentCategory === 'Writing') {
                    return await generateWritingHtml(item);
                } else if (currentCategory === 'Websites') {
                    return await generateWebsiteHtml(item);
                }
            });

            const htmlArray = await Promise.all(htmlPromises);
            return htmlArray.filter(html => html !== null);
        }

        async function generateAppHtml([appStoreUrl, manualName, category, ourDescription]) {
            if (!appStoreUrl) return null;

            const appMeta = await getAppMetadata(appStoreUrl);
            const title = appMeta?.name || manualName || 'Unknown App';
            const subtitle = appMeta?.subtitle || '';
            const description = ourDescription || appMeta?.description || '';

            return `
                <div class="item">
                    <div class="item-title"><a href="${appStoreUrl}" target="_blank">${title}</a></div>
                    ${subtitle ? `<div class="item-meta">${subtitle}</div>` : ''}
                    ${description ? `<div class="item-description">${description.substring(0, 200)}${description.length > 200 ? '...' : ''}</div>` : ''}
                </div>
            `;
        }

        async function generateSongHtml([title, appleMusicUrl, artist]) {
            if (!appleMusicUrl || !title) return null;

            const songMeta = await getSongMetadata(appleMusicUrl);
            const trackName = songMeta?.trackName || title;
            const artistName = songMeta?.artistName || artist;
            const albumName = songMeta?.albumName || '';

            return `
                <div class="item">
                    <div class="item-title"><a href="${appleMusicUrl}" target="_blank">${trackName}</a></div>
                    <div class="item-meta">${artistName}${albumName ? ` - ${albumName}` : ''}</div>
                </div>
            `;
        }

        async function generateBookHtml([title, appleBooksUrl, ourDescription]) {
            if (!appleBooksUrl || !title) return null;

            const bookMeta = await getBookMetadata(appleBooksUrl);
            const bookTitle = bookMeta?.trackName || title;
            const authorName = bookMeta?.artistName || '';
            const description = ourDescription || bookMeta?.description || '';

            return `
                <div class="item">
                    <div class="item-title"><a href="${appleBooksUrl}" target="_blank">${bookTitle}</a></div>
                    ${authorName ? `<div class="item-meta">by ${authorName}</div>` : ''}
                    ${description ? `<div class="item-description">${description.substring(0, 200)}${description.length > 200 ? '...' : ''}</div>` : ''}
                </div>
            `;
        }

        async function generateVideoHtml([title, youtubeUrl]) {
            if (!youtubeUrl || !title) return null;

            const videoMeta = await getVideoMetadata(youtubeUrl, title);
            const videoTitle = videoMeta?.title || title;
            const author = videoMeta?.author || '';

            return `
                <div class="item">
                    <div class="item-title"><a href="${youtubeUrl}" target="_blank">${title}</a></div>
                    ${videoTitle !== title ? `<div class="item-meta">${videoTitle}</div>` : ''}
                    ${author ? `<div class="item-meta">${author}</div>` : ''}
                </div>
            `;
        }

        async function generateWritingHtml([title, url, author, description]) {
            if (!url || !title) return null;

            const domain = new URL(url).hostname;

            return `
                <div class="item">
                    <div class="item-title"><a href="${url}" target="_blank">${title}</a></div>
                    ${author ? `<div class="item-meta">by ${author} - ${domain}</div>` : `<div class="item-meta">${domain}</div>`}
                    ${description ? `<div class="item-description">${description}</div>` : ''}
                </div>
            `;
        }

        async function generateWebsiteHtml([title, url, description]) {
            if (!url || !title) return null;

            const domain = new URL(url).hostname;

            return `
                <div class="item">
                    <div class="item-title"><a href="${url}" target="_blank">${title}</a></div>
                    <div class="item-meta">${domain}</div>
                    ${description ? `<div class="item-description">${description}</div>` : ''}
                </div>
            `;
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', async function() {
            await loadAllData();
        });
    </script>
</body>
</html>
